"use strict";

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");

var _chai = require("chai");

var _winDoc = require("win-doc");

var _index = _interopRequireDefault(require("../index"));

var _this = void 0;

describe("Test Non Worker", function () {
  it("simulate support worker", function () {
    // simulate inside worker
    global.onmessage = function () {};

    global.postMessage = null;
    var oNonWorker = new _index["default"](function (e) {
      (0, _chai.expect)(e).to.deep.equal({
        data: "fake"
      });
    });

    var post = function post(payload) {
      oNonWorker.post.call(_this, payload);
    }; // simulate outside worker


    oNonWorker.addEventListener("message", function (e) {
      (0, _chai.expect)(e).to.deep.equal({
        data: "bar"
      });
    }); // post from outside

    oNonWorker.postMessage("fake"); // post from inside

    post("bar");
  });
  it("simulate without worker", function () {
    // simulate inside worker
    global.onmessage = null;
    global.postMessage = null;
    (0, _winDoc.win)().__null = false;
    var oNonWorker = new _index["default"](function (e) {
      (0, _chai.expect)(e).to.deep.equal({
        data: "fake"
      });
    });

    var post = function post(payload) {
      oNonWorker.post.call(_this, payload);
    }; // simulate outside worker


    oNonWorker.addEventListener("message", function (e) {
      (0, _chai.expect)(e).to.deep.equal({
        data: "bar"
      });
    }); // post from outside

    oNonWorker.postMessage("fake"); // post from inside

    post("bar");
  });
});