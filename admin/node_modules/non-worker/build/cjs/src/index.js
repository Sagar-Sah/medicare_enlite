"use strict";

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _createClass2 = _interopRequireDefault(require("reshow-runtime/helpers/createClass"));

var _classCallCheck2 = _interopRequireDefault(require("reshow-runtime/helpers/classCallCheck"));

var _defineProperty2 = _interopRequireDefault(require("reshow-runtime/helpers/defineProperty"));

require("array.polyfill");

var _winDoc = require("win-doc");

var NonWorker = /*#__PURE__*/(0, _createClass2["default"])(function NonWorker(_callback) {
  var _this = this;

  (0, _classCallCheck2["default"])(this, NonWorker);
  (0, _defineProperty2["default"])(this, "callbacks", []);
  (0, _defineProperty2["default"])(this, "addEventListener", function (type, callback) {
    return _this.callbacks.push(callback);
  });
  (0, _defineProperty2["default"])(this, "postMessage", function (data) {
    var e = {
      data: data
    };

    _this.onmessage(e);
  });

  /**
   * Call from inside worker
   */
  this.post = function (data) {
    var e = {
      data: data
    };

    _this.callbacks.forEach(function (c) {
      return c(e);
    });
  };

  this.onmessage = _callback;

  if ((0, _winDoc.win)().__null) {
    try {
      onmessage = _callback;
    } catch (e) {
      console.error(e);
    }

    try {
      var post = postMessage;

      if (post) {
        // only trigger for worker 
        // use case: https://github.com/react-atomic/react-atomic-organism/blob/main/packages/organism-react-ajax/src/stores/ajaxStore.js#L23-L27
        post({
          type: "ready"
        });
        /**
         * Replace really woker post (insider)
         */

        this.post = post;
      }
    } catch (e) {
      console.error(e);
    }
  }
}
/**
 * Register for outside
 */
);
var _default = NonWorker;
exports["default"] = _default;
module.exports = exports.default;