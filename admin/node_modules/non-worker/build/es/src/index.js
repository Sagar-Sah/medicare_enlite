import _createClass from "reshow-runtime/es/helpers/createClass";
import _classCallCheck from "reshow-runtime/es/helpers/classCallCheck";
import _defineProperty from "reshow-runtime/es/helpers/defineProperty";
import "array.polyfill";
import { win } from "win-doc";

var NonWorker = /*#__PURE__*/_createClass(function NonWorker(_callback) {
  var _this = this;

  _classCallCheck(this, NonWorker);

  _defineProperty(this, "callbacks", []);

  _defineProperty(this, "addEventListener", function (type, callback) {
    return _this.callbacks.push(callback);
  });

  _defineProperty(this, "postMessage", function (data) {
    var e = {
      data: data
    };

    _this.onmessage(e);
  });

  /**
   * Call from inside worker
   */
  this.post = function (data) {
    var e = {
      data: data
    };

    _this.callbacks.forEach(function (c) {
      return c(e);
    });
  };

  this.onmessage = _callback;

  if (win().__null) {
    try {
      onmessage = _callback;
    } catch (e) {
      console.error(e);
    }

    try {
      var post = postMessage;

      if (post) {
        // only trigger for worker 
        // use case: https://github.com/react-atomic/react-atomic-organism/blob/main/packages/organism-react-ajax/src/stores/ajaxStore.js#L23-L27
        post({
          type: "ready"
        });
        /**
         * Replace really woker post (insider)
         */

        this.post = post;
      }
    } catch (e) {
      console.error(e);
    }
  }
}
/**
 * Register for outside
 */
);

export default NonWorker;