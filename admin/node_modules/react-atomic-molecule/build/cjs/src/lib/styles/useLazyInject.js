"use strict";

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports["default"] = void 0;

var _react = require("react");

var _reshowConstant = require("reshow-constant");

var _lazyInject = _interopRequireDefault(require("./lazyInject.js"));

var _injectStyle = _interopRequireDefault(require("./injectStyle.js"));

var _cleanStyleTag = _interopRequireDefault(require("./cleanStyleTag.js"));

var _genStyleId = _interopRequireDefault(require("./genStyleId.js"));

var useLazyInject = function useLazyInject(InjectStyles, existsInjection) {
  var _useState = (0, _react.useState)(function () {
    return (0, _genStyleId["default"])("o");
  }),
      oid = _useState[0];

  var injects = (0, _react.useRef)();

  var resetInject = function resetInject() {
    if (!injects.current) {
      if (!existsInjection) {
        existsInjection = (0, _lazyInject["default"])(InjectStyles, existsInjection);
      }

      injects.current = existsInjection;
    }
  };

  resetInject();
  (0, _react.useEffect)(function () {
    if (!injects.current) {
      resetInject();
    }

    if (!injects.current._mounted) {
      (0, _injectStyle["default"])(injects.current);
      injects.current._mounted = (0, _reshowConstant.NEW_OBJ)();
    }

    injects.current._mounted[oid] = true;
    return function () {
      delete injects.current._mounted[oid];

      if (!(0, _reshowConstant.OBJ_SIZE)(injects.current._mounted)) {
        delete injects.current._mounted;
        (0, _cleanStyleTag["default"])(injects.current);
      }
    };
  }, []);
  return injects.current;
};

var _default = useLazyInject;
exports["default"] = _default;
module.exports = exports.default;