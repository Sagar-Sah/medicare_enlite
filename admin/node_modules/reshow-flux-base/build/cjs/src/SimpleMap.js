"use strict";

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");
exports.__esModule = true;
exports["default"] = void 0;
var _objectSpread3 = _interopRequireDefault(require("reshow-runtime/helpers/objectSpread2"));
var _classCallCheck2 = _interopRequireDefault(require("reshow-runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("reshow-runtime/helpers/createClass"));
var _defineProperty2 = _interopRequireDefault(require("reshow-runtime/helpers/defineProperty"));
var _getObjectValue = require("get-object-value");
var _reshowConstant = require("reshow-constant");
// @ts-check
var SimpleMap = /*#__PURE__*/function () {
  /**
   * @param {object} obj
   * @param {boolean} needUpdate
   */
  function SimpleMap(obj, needUpdate) {
    if (needUpdate === void 0) {
      needUpdate = false;
    }
    (0, _classCallCheck2["default"])(this, SimpleMap);
    (0, _defineProperty2["default"])(this, "_state", {});
    (0, _defineProperty2["default"])(this, "_update", false);
    if (obj) {
      this._state = obj;
    }
    if (needUpdate) {
      this._update = needUpdate;
    }
  }

  /**
   * @param {object} obj
   * @returns {SimpleMap}
   */
  (0, _createClass2["default"])(SimpleMap, [{
    key: "renew",
    value: function renew(obj) {
      if (this._update) {
        this._state = obj;
      }
      return new SimpleMap(obj);
    }

    /**
     * @param {string} k
     * @returns {any}
     */
  }, {
    key: "get",
    value: function get(k) {
      return _reshowConstant.OBJECT === typeof this._state[k] && null !== this._state[k] ? new SimpleMap(this._state[k]) : this._state[k];
    }

    /**
     * @param {string} k
     * @param {any} v
     * @returns {SimpleMap}
     */
  }, {
    key: "set",
    value: function set(k, v) {
      var _objectSpread2;
      var state = (0, _objectSpread3["default"])((0, _objectSpread3["default"])({}, this._state), {}, (_objectSpread2 = {}, _objectSpread2[k] = (0, _getObjectValue.toJS)(v), _objectSpread2));
      return this.renew(state);
    }

    /**
     * @param {string} k
     * @returns {SimpleMap}
     */
  }, {
    key: "delete",
    value: function _delete(k) {
      var state = (0, _objectSpread3["default"])({}, this._state);
      delete state[k];
      return this.renew(state);
    }

    /**
     * @param {object|SimpleMap} arr
     * @returns {SimpleMap}
     */
  }, {
    key: "merge",
    value: function merge(arr) {
      var state = (0, _objectSpread3["default"])((0, _objectSpread3["default"])({}, this._state), (0, _getObjectValue.toJS)(arr));
      return this.renew(state);
    }

    /**
     * @returns {object}
     */
  }, {
    key: "toJS",
    value: function toJS() {
      return this._state;
    }
  }]);
  return SimpleMap;
}();
var _default = SimpleMap;
exports["default"] = _default;
module.exports = exports.default;